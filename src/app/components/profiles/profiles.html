<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 mb-1 fw-bold">Profile Management</h2>
          <p class="text-muted mb-0">Manage and monitor user profiles</p>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-primary" (click)="loadProfiles()">
            <i class="pi pi-refresh me-2" [class.pi-spin]="isLoading"></i>
            Refresh
          </button>
          @if (userRole === 'admin') {
            <button class="btn btn-primary">
              <i class="pi pi-plus me-2"></i>
              Add Profile
            </button>
          }
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                  <div class="bg-primary bg-opacity-10 rounded-3 p-3">
                    <i class="pi pi-users text-primary fs-4"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="text-muted mb-1 fw-semibold">Total Profiles</h6>
                  <h4 class="mb-0 fw-bold text-dark">{{ profiles.length }}</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                  <div class="bg-success bg-opacity-10 rounded-3 p-3">
                    <i class="pi pi-check-circle text-success fs-4"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="text-muted mb-1 fw-semibold">Active Profiles</h6>
                  <h4 class="mb-0 fw-bold text-dark">{{ getActiveProfilesCount() }}</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                  <div class="bg-warning bg-opacity-10 rounded-3 p-3">
                    <i class="pi pi-star text-warning fs-4"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="text-muted mb-1 fw-semibold">Featured</h6>
                  <h4 class="mb-0 fw-bold text-dark">{{ featuredProfiles.length }}</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                  <div class="bg-info bg-opacity-10 rounded-3 p-3">
                    <i class="pi pi-circle text-info fs-4"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="text-muted mb-1 fw-semibold">Online Now</h6>
                  <h4 class="mb-0 fw-bold text-dark">{{ getOnlineProfilesCount() }}</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters and Search -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="input-group">
                <span class="input-group-text">
                  <i class="pi pi-search"></i>
                </span>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search profiles by name, country, or interests..."
                  [(ngModel)]="searchTerm"
                  (input)="onSearch()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <select
                class="form-select"
                [(ngModel)]="statusFilter"
                (change)="onFilterChange()"
              >
                <option value="">All Profiles</option>
                <option value="active">Active Only</option>
                <option value="inactive">Inactive Only</option>
              </select>
            </div>
            <div class="col-md-3">
              <div class="text-muted small d-flex align-items-center">
                <i class="pi pi-info-circle me-2"></i>
                Showing {{ getFilteredProfiles().length }} profiles
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profiles Grid -->
      @if (isLoading) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading profiles...</p>
        </div>
      } @else if (getFilteredProfiles().length === 0) {
        <div class="text-center py-5">
          <i class="pi pi-users fs-1 text-muted mb-3"></i>
          <h5 class="text-muted">No profiles found</h5>
          <p class="text-muted">Try adjusting your search or filter criteria</p>
        </div>
      } @else {
        <div class="row g-4">
          @for (profile of getFilteredProfiles(); track profile.id) {
            <div class="col-12 col-md-6 col-lg-4 col-xl-3">
              <div class="card border-0 shadow-sm h-100 profile-card">
                <div class="position-relative">
                  <img 
                    [src]="profile.profile_photo" 
                    [alt]="profile.name"
                    class="card-img-top profile-image"
                    style="height: 250px; object-fit: cover;"
                  />
                  
                  <!-- Online Status Badge -->
                  <div class="position-absolute top-0 end-0 m-2">
                    <span class="badge" [class]="getOnlineStatusClass(profile.is_online)">
                      <i class="pi pi-circle me-1"></i>
                      {{ profile.is_online ? 'Online' : 'Offline' }}
                    </span>
                  </div>
                  
                  <!-- Featured Badge -->
                  @if (profile.is_featured) {
                    <div class="position-absolute top-0 start-0 m-2">
                      <span class="badge bg-warning">
                        <i class="pi pi-star me-1"></i>
                        Featured
                      </span>
                    </div>
                  }
                </div>
                
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0 fw-bold">{{ profile.name }}</h5>
                    <span class="badge bg-light text-dark">{{ profile.age }} years</span>
                  </div>
                  
                  <div class="d-flex align-items-center text-muted mb-2">
                    <i class="pi pi-map-marker me-2"></i>
                    <small>{{ profile.city }}, {{ profile.country }}</small>
                  </div>
                  
                  <p class="card-text text-muted small mb-3" style="height: 60px; overflow: hidden;">
                    {{ profile.bio }}
                  </p>
                  
                  <!-- Interests -->
                  <div class="mb-3">
                    <div class="d-flex flex-wrap gap-1">
                      @for (interest of profile.interests.slice(0, 3); track interest) {
                        <span class="badge bg-light text-dark small">{{ interest }}</span>
                      }
                      @if (profile.interests.length > 3) {
                        <span class="badge bg-secondary small">+{{ profile.interests.length - 3 }} more</span>
                      }
                    </div>
                  </div>
                  
                  <!-- Stats -->
                  <div class="row g-2 mb-3">
                    <div class="col-6">
                      <div class="text-center">
                        <div class="fw-bold text-primary">{{ profile.total_chats }}</div>
                        <small class="text-muted">Chats</small>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="text-center">
                        <div class="fw-bold text-success">${{ profile.total_earnings }}</div>
                        <small class="text-muted">Earnings</small>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Actions -->
                <div class="card-footer bg-transparent border-0 pt-0">
                  <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary btn-sm flex-fill" (click)="viewProfile(profile)">
                      <i class="pi pi-eye me-1"></i>
                      View
                    </button>
                    @if (userRole === 'admin') {
                      <button class="btn btn-outline-secondary btn-sm" (click)="editProfile(profile)">
                        <i class="pi pi-pencil"></i>
                      </button>
                      <div class="dropdown">
                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" 
                                type="button" 
                                [id]="'profileDropdown' + profile.id"
                                data-bs-toggle="dropdown" 
                                aria-expanded="false">
                          <i class="pi pi-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu" [attr.aria-labelledby]="'profileDropdown' + profile.id">
                          <li>
                            <button class="dropdown-item" (click)="toggleFeatured(profile)">
                              <i class="pi me-2" [class]="profile.is_featured ? 'pi-star-fill' : 'pi-star'"></i>
                              {{ profile.is_featured ? 'Remove Featured' : 'Make Featured' }}
                            </button>
                          </li>
                          <li>
                            <button class="dropdown-item" (click)="toggleActive(profile)">
                              <i class="pi me-2" [class]="profile.is_active ? 'pi-eye-slash' : 'pi-eye'"></i>
                              {{ profile.is_active ? 'Deactivate' : 'Activate' }}
                            </button>
                          </li>
                          <li><hr class="dropdown-divider"></li>
                          <li>
                            <button class="dropdown-item text-danger" (click)="deleteProfile(profile.id)">
                              <i class="pi pi-trash me-2"></i>
                              Delete Profile
                            </button>
                          </li>
                        </ul>
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>